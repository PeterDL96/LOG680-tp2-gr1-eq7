language: python
python:
  - "3.8"
services:
  - docker

# Build docker image and test
before_install:
  - docker build -t projetsplets1/log680-lab2 .
  - docker ps -a
  - docker run projetsplets1/log680-lab2 python3 test/test_main.py

install:
  - curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
  - chmod +x ./kubectl
  - sudo mv ./kubectl /usr/local/bin/kubectl
  - mkdir ${HOME}/.kube
  - echo "$KUBE_CONFIG" | base64 --decode > ${HOME}/.kube/config

# Deploy docker image
deploy:
  provider: script
  script: bash docker_deploy.sh
  on:
    branch: main

script: 
  - kubectl get pods
